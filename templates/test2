@content_bp.route('/edit_content/<int:id>', methods=['GET', 'POST'])
def edit_content(id):
    form = ContentForm()
    edit = Content.query.get_or_404(id)

    if request.method == 'POST' and form.validate_on_submit():
        # Обновление данных контента
        edit.title = request.form['title']
        edit.web_link = request.form['web_link']
        edit.tag = request.form['tag']

        # Замена файла, если был загружен новый
        file = form.file.data
        if file:
            # Старое имя файла
            old_file_name = edit.file_name
            
            # Новое имя файла на основе нового заголовка (title)
            extension = file.filename.split('.')[-1].lower()
            new_file_name = secure_filename(f'{edit.title}.{extension}')

            # Удаление старого файла
            try:
                if old_file_name and os.path.exists(os.path.join(current_app.config['FILES_UPLOAD_FOLDER'], old_file_name)):
                    os.remove(os.path.join(current_app.config['FILES_UPLOAD_FOLDER'], old_file_name))
                    flash('Старый файл удален')
            except Exception as e:
                flash(f'Ошибка при удалении старого файла: {str(e)}')

            # Сохранение нового файла
            try:
                file.save(os.path.join(current_app.config['FILES_UPLOAD_FOLDER'], new_file_name))
                edit.file_name = new_file_name  # Обновление имени файла в базе данных
                flash('Файл обновлен')
            except Exception as e:
                flash(f'Ошибка при сохранении нового файла: {str(e)}')

        # Обновление информации в базе данных
        try:
            db.session.commit()
            flash('Контент обновлен')
            return render_template('content.html', form=form, content=edit)
        except Exception as e:
            db.session.rollback()
            flash(f'Ошибка при обновлении контента: {str(e)}')
            return render_template('content.html', form=form, content=edit)
    
    return render_template('content.html', form=form, content=edit)
